import type { ActionFunction, LoaderFunction } from "@remix-run/node";
import type { ButtonHTMLAttributes } from "react";

import { useForm } from "@conform-to/react";
import { redirect } from "@remix-run/node";
import { useFetcher } from "@remix-run/react";
import { clsx } from "clsx";

import { authenticator } from "~/utils/auth.server.ts";

export const loader: LoaderFunction = () => redirect("/admin");

export const action: ActionFunction = ({ request }) => {
  return authenticator.authenticate("okta", request);
};

export function OktaLoginForm() {
  const oktaLoginFetcher = useFetcher<typeof action>();

  const [form] = useForm({
    id: "okta-login-form",
    lastSubmission: oktaLoginFetcher.data?.submission
  });

  return (
    <oktaLoginFetcher.Form action="/auth/okta" method="POST" {...form.props}>
      <OktaLoginButton className="mt-4" state={oktaLoginFetcher.state} />
    </oktaLoginFetcher.Form>
  );
}

interface OktaLoginButtonProps extends ButtonHTMLAttributes<HTMLButtonElement> {
  state?: "idle" | "loading" | "submitting";
  title?: string;
}

export function OktaLoginButton({
  disabled,
  state = "idle",
  title = "Sign in with Okta",
  ...props
}: OktaLoginButtonProps) {
  return (
    <button
      {...props}
      className={clsx(
        props.className,
        "inline-flex items-center rounded bg-[#3c5ae0] px-4 py-2 font-semibold text-white duration-300 hover:shadow-lg hover:brightness-110 disabled:cursor-not-allowed disabled:opacity-75"
      )}
      disabled={disabled || state !== "idle"}
    >
      <OktaAuraLogo
        className={clsx(
          "mr-2 h-8 w-8 text-white",
          state !== "idle" && "animate-spin-slow inline-block"
        )}
      />
      <span>{title}</span>
    </button>
  );
}

type OktaAuraLogoType = {
  className?: string;
  title?: string;
};

function OktaAuraLogo({
  className = "",
  title = "Okta Aura Logo"
}: OktaAuraLogoType) {
  return (
    <svg
      className={className}
      fill="none"
      viewBox="0 0 1479 1480"
      xmlns="http://www.w3.org/2000/svg"
    >
      <title>{title}</title>
      <g>
        <path
          d="M699 1.70006C696.7 2.90006 695.1 4.60006 694.5 6.70006C693.7 9.10006 695.1 30.7001 700.7 98.2001C704.6 146.8 707.9 188.4 707.9 190.7L708 195H673.8L670.9 197.9C668.7 200.1 668 201.8 668 204.7C668 210.1 684.8 386.2 685.4 386.7C685.6 387 692.3 386.5 700.2 385.6C727.3 382.7 757 382.7 778.9 385.6L783.5 386.2L798.5 201.8C806.7 100.5 813.5 14.9 813.5 11.8C813.5 6.80004 813.1 5.70004 810.7 3.30004L808 0.500048L755.2 0.20006C706.5 6.00368e-05 702.2 0.10006 699 1.70006ZM500 40.1001C472.8 50.0001 449.7 58.9 448.7 59.9C443.9 64.6 443.1 62.6 484.4 152.6C505.6 198.9 523 237.1 523 237.7C523 238.2 516.3 241 508.1 243.9C491.3 249.9 488.5 251.9 488.6 257.8C488.6 260.5 498.9 283 527.9 344C549.5 389.4 567.3 426.6 567.5 426.8C567.6 427 573.3 424.4 580 421C602 410 630.9 399.2 651.3 394.4C655.6 393.4 659 392.1 659 391.4C659 389.3 560 29.6001 558.7 27.1001C557.7 25.0001 552.6 21.9 550.3 22C549.9 22 527.2 30.2001 500 40.1001ZM949.1 34.7001C946.3 37.3001 944.4 43.6 922 125.5C908.8 173.9 897.6 214.3 897.2 215.2C896.6 216.6 894.8 216.2 882 211.5C874 208.5 866.1 206.1 864.4 206C860.4 206 856.4 209.1 855.1 213.3C854.5 215 844.1 254.7 832 301.5C819.9 348.2 809.7 387.3 809.4 388.2C809 389.4 809.6 390.1 811.2 390.4C838.4 396.1 865.6 405.2 889.9 416.6C896.2 419.6 901.7 421.7 902.1 421.3C902.8 420.5 1057.3 83.9001 1059.1 79.1001C1060.3 76.0001 1058.5 70.4 1055.7 68.5C1052.3 66.4 957 32 954.4 32C953.1 32 950.7 33.2001 949.1 34.7001ZM313.4 132.2C305.4 138.3 235.9 197.2 234.6 199.2C233.7 200.4 233 203 233 204.8C233 207.8 235.4 210.6 257.9 233.8C271.6 248 288.8 265.3 296 272.5C303.2 279.6 321.7 298.4 337 314.1L364.9 342.7L352.4 353C345.5 358.7 339.5 364.2 338.9 365.1C337 368.7 337.9 372.9 341.5 376.9C343.5 379 373.3 408.7 407.9 442.9L470.7 505L484.6 490.9C500.7 474.6 517.1 460.5 533.4 449C539.8 444.5 545 440.6 545 440.4C545 439.2 329.2 135.9 326.4 133.2C322.3 129.3 317.8 128.9 313.4 132.2ZM1176.2 149.3C1175 150 1149.9 184.5 1120.5 225.9C1091.2 267.3 1066.9 301.4 1066.6 301.7C1066.4 302 1060.6 297.5 1053.7 291.7C1046.9 285.9 1040.3 280.9 1039.1 280.5C1036.2 279.6 1031.6 280.7 1029.7 282.8C1028 284.7 925 433.9 925 434.5C925 434.7 929.6 437.9 935.2 441.7C954.8 454.6 974.4 470.5 991.8 487.7L1001.1 496.9L1133.8 362.5C1206.7 288.5 1266.8 227 1267.3 225.8C1267.7 224.5 1267.9 222 1267.5 220.3C1267 217.5 1261.4 212.4 1227.2 183.7C1205.4 165.3 1186.5 149.8 1185.3 149.2C1182.5 147.7 1179.1 147.7 1176.2 149.3ZM132.8 312.7C131.4 314.3 118.9 335.3 104.9 359.5C78.6 405.3 77.8 407 81.2 412.1C82.3 413.8 106.6 425.8 166.1 453.9C212 475.6 249.9 493.7 250.4 494.1C250.9 494.5 247.6 501.1 243.1 508.8C234.1 524.2 233.2 527.9 237.3 532.3C238.7 533.9 270.8 549.1 322.4 572.6C368 593.5 405.6 610.6 405.9 610.7C406.2 610.9 409.3 604.6 412.7 596.7C422.8 573.7 435 552.7 453.5 526.3C454.2 525.3 454.1 524.6 453 524C452.2 523.5 382.2 475.1 297.5 416.6C155.5 318.4 143.2 310.1 139.4 310C136.3 310 134.8 310.6 132.8 312.7ZM1350.1 334.7C1349.3 335 1314.5 358.9 1272.8 387.8C1230.6 416.9 1196.5 439.8 1196 439.4C1195.5 438.9 1191.9 432.9 1188 426C1184.1 419.1 1179.8 412.5 1178.4 411.2C1175.4 408.5 1170.5 408.3 1167 410.7C1162 414.1 1019.5 515.3 1018.7 516C1018.3 516.4 1020.8 520.6 1024.5 525.4C1039 544.7 1050.1 562.8 1061 585.1C1064.8 593 1068.1 599.8 1068.3 600.3C1068.7 601.5 1408.1 440.3 1411 437.5C1416.1 432.4 1415.6 431.5 1387.6 383C1373.5 358.5 1361.1 337.7 1360.1 336.7C1358.3 334.8 1352.5 333.7 1350.1 334.7ZM26.9 541.5C25.5 542.3 23.8 544.2 23.2 545.7C21.7 549.3 5 644.5 5 649.2C5 653 7.79999 657.5 10.8 658.4C11.7 658.7 53.9 662.8 104.5 667.6C155.1 672.3 196.6 676.3 196.7 676.3C196.8 676.4 195.5 683.9 193.9 692.8C191.4 706.7 191.2 709.5 192.2 711.7C195.3 718 191.1 717.4 286 724.9C334.1 728.8 375.6 732.1 378.1 732.4L382.7 732.9L383.3 720.2C384.6 695.8 389 668.1 395 646.5C396.7 640.6 397.9 635.6 397.8 635.5C397.1 634.9 32.3 540 31 540C30.2 540.1 28.3 540.7 26.9 541.5ZM1360.5 591.6C1311.6 604.4 1271.5 614.8 1271.4 614.7C1271.3 614.6 1270.1 607.5 1268.6 599C1265.8 582.8 1264.5 579.6 1259.7 577.2C1257.3 576 1248.9 578.2 1167.8 600.5C1118.7 614.1 1078.4 625.3 1078.2 625.4C1078.1 625.6 1080 632.6 1082.4 641.1C1089.1 664.5 1093.7 689.7 1095.5 713.2C1095.9 718.1 1096.6 722 1096.9 722C1100 722 1470.7 686.9 1472.6 686.4C1476.1 685.5 1479 681.3 1479 677.3C1479 672.7 1462.3 577.4 1460.8 573.7C1459.6 570.6 1455.3 567.9 1451.8 568.1C1450.5 568.2 1409.5 578.7 1360.5 591.6ZM1095.7 761C1094.5 784.2 1090.5 809.3 1084.1 833.5C1082.5 839.5 1081.4 844.7 1081.6 844.9C1082.6 845.9 1444.8 940 1447.7 940C1449.6 940 1452 939.1 1453.6 937.7C1456.2 935.4 1456.7 933.5 1465.2 885.4C1470 858 1474.1 833.9 1474.1 831.9C1474.2 827.9 1472.7 824.9 1469.7 823C1468.4 822.2 1434.1 818.6 1375.4 813.1C1324.6 808.3 1282.9 804.2 1282.7 804C1282.4 803.7 1283.5 796.3 1285.1 787.5C1287.9 772.1 1287.9 771.5 1286.2 768C1284.9 765.4 1283.5 764.2 1280.5 763.3C1277.6 762.3 1105.1 748 1097.4 748C1096.7 748 1096.1 752.6 1095.7 761ZM190.5 776.6C89.9 786.1 7.19999 793.9 6.79999 794C6.49999 794 4.80001 795.2 3.10001 796.6C0.600006 798.7 0 800 0 803.1C0 806.3 15.9 898.6 17.6 905.6C18.5 909.2 22.7 912.4 26.3 912.4C28 912.3 69.5 901.9 118.3 889.1C167.2 876.3 207.3 866 207.5 866.2C207.7 866.3 209 873.5 210.5 882C211.9 890.5 213.6 898.2 214.1 899.2C215.5 901.8 219.1 904 222.1 904C225.2 904 399.1 856.2 400.3 855C400.8 854.6 400 850.6 398.6 846.1C394.8 834 390.4 816 388 803C386.2 792.4 383 766.6 383 761.2C383 759.2 382.5 759 378.3 759.1C375.6 759.2 291.2 767 190.5 776.6ZM1069.5 876.7C1060.9 897.6 1046.6 923.5 1032.3 944.4C1026.2 953.3 1025.1 955.5 1026.2 956.5C1026.9 957.2 1096.8 1005.6 1181.5 1064.1C1325.6 1163.6 1335.8 1170.4 1339.7 1170.5C1342.7 1170.5 1344.5 1169.9 1345.9 1168.5C1347 1167.4 1359.4 1146.5 1373.6 1122C1401.6 1073.6 1402 1072.5 1397 1067.6C1395.6 1066.3 1357.2 1047.5 1311.5 1025.9C1265.9 1004.3 1228.3 986.5 1228.1 986.3C1227.8 986.1 1228.5 984.5 1229.5 982.7C1245.3 956 1246.2 953.4 1241.3 948.2C1239.3 946.1 1214.3 934.3 1156 907.6C1110.6 886.9 1073.2 870 1072.9 870C1072.6 870 1071 873 1069.5 876.7ZM238.5 960.9C86.6 1033.1 68.3 1042 66.7 1044.8C65.5 1046.9 65 1048.9 65.4 1050.7C66.2 1054.1 116 1140.6 119 1143.7C121.4 1146.2 124.3 1146.9 128 1145.9C129.4 1145.6 159.1 1125.5 194 1101.3C228.9 1077.2 263.2 1053.5 270.1 1048.7L282.8 1040L291.1 1054.7C298.1 1066.9 300 1069.5 302.9 1070.7C305.3 1071.7 307 1071.9 309.1 1071.1C311.8 1070.2 455.5 968.7 459.2 965.1C460.8 963.6 460.3 962.7 452.2 951.8C438.1 932.9 425 910.8 415.9 891C413.2 885.2 410.5 880.4 409.8 880.3C409.1 880.2 332 916.5 238.5 960.9ZM997.5 986.7C992 992.6 983 1001.4 977.5 1006.3C967.6 1015.1 943.5 1033.8 937.2 1037.5C935.4 1038.6 934.2 1040 934.4 1040.6C935 1042.2 1149.9 1345.1 1152.3 1347.7C1154.8 1350.5 1160 1351.6 1163.1 1349.9C1167 1347.9 1244.7 1282.2 1245.4 1280.4C1245.7 1279.6 1246 1277.2 1246 1275.2C1246 1271.3 1255.1 1280.7 1142.7 1167.4L1113.8 1138.3L1126.2 1128C1132.9 1122.4 1139 1116.8 1139.7 1115.6C1140.4 1114.5 1140.9 1112 1141 1110.1C1141 1106.9 1138 1103.7 1093.8 1060.1C1067.8 1034.5 1037.9 1005.1 1027.5 994.8C1017 984.5 1008.2 976 1008 976.1C1007.7 976.1 1003 980.9 997.5 986.7ZM355 1108.1C287.6 1176.3 227.7 1237.2 221.8 1243.5C210.5 1255.5 209.4 1257.6 212.3 1262.6C213 1263.8 227.9 1276.8 245.5 1291.6C263.1 1306.3 281.3 1321.5 285.9 1325.4C293 1331.4 294.8 1332.5 298.1 1332.5C300.4 1332.5 302.7 1331.7 304 1330.5C305.2 1329.4 330 1294.9 359.2 1253.8C388.3 1212.7 412.5 1179 412.9 1179C413.2 1179 419.1 1183.7 426 1189.4C432.8 1195.1 439.4 1200 440.6 1200.3C441.8 1200.5 444.2 1200.2 446 1199.6C448.9 1198.6 456.1 1188.7 501.6 1122.5C530.4 1080.7 554 1046.3 554 1046C554 1045.7 548.6 1041.9 542 1037.6C525.7 1026.9 506.4 1011.2 491 996.3C484 989.6 478.1 984 477.9 984C477.7 984 422.4 1039.9 355 1108.1ZM897.7 1060.1C876.8 1070.7 852.9 1079.7 828.8 1086C823.9 1087.3 820 1088.8 820 1089.4C820 1090 842.5 1172.2 869.9 1272C915 1435.9 920.1 1453.7 922.5 1455.7C923.9 1457 926.4 1458 928 1458C930.8 1458 1025.2 1424.1 1029 1421.8C1031.6 1420.1 1033.4 1415.6 1032.7 1412.2C1032.4 1410.7 1015 1372.2 994.1 1326.6C973.1 1281.1 956 1243.4 956 1243C956 1242.1 957.3 1241.6 976.7 1234.5C982.3 1232.5 987.6 1230 988.5 1229C992.9 1224.1 993.7 1225.9 951.6 1137.5C929.9 1091.8 911.5 1054.4 910.8 1054.3C910.1 1054.2 904.2 1056.8 897.7 1060.1ZM575.5 1061.8C574.6 1063.8 539.1 1141.1 496.7 1233.5C440.7 1355.6 419.7 1402.4 419.7 1404.9C419.8 1407 420.7 1409.1 422.2 1410.6C423.8 1412.3 438.9 1418.2 469.7 1429.5C529.4 1451.2 523.4 1449.3 527.5 1447.6C529.3 1446.8 531.4 1445.2 532 1443.9C532.7 1442.7 544.2 1401.9 557.5 1353.3C570.9 1304.6 582.1 1264.6 582.3 1264.3C582.6 1264 589.9 1266.4 598.4 1269.6C615.5 1275.9 618.5 1276 622.1 1271C623.6 1268.9 670.6 1091 669.8 1090.5C669.6 1090.5 664.8 1089.4 659 1088.1C637 1083.3 605 1072 585.9 1062.4L577.3 1058.1L575.5 1061.8ZM783 1094.7C772.1 1096.4 721.6 1097 705.5 1095.7L695.5 1094.9L680.2 1283.4C666.1 1457.6 665.1 1472.2 666.5 1475C667.3 1476.6 668.9 1478.4 669.9 1479C671.2 1479.6 690.6 1480 725.4 1480H779L782.2 1477.1C785.1 1474.6 785.3 1473.8 785.2 1468.9C785.1 1465.9 781.9 1424.8 778 1377.4C774.2 1330.1 771 1290.2 771 1288.7V1286.1L788.6 1285.8L806.2 1285.5L808.6 1282.7C810.3 1280.8 811 1278.7 811 1276C811 1272.5 796.1 1112.2 794.5 1098.2C794.1 1095.4 793.6 1093.1 793.2 1093.1C792.8 1093.2 788.2 1093.9 783 1094.7Z"
          fill="currentColor"
        />
      </g>
    </svg>
  );
}
